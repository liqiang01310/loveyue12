<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>浪漫魔法爱心</title>
<style>
body{
    margin:0;
    overflow:hidden;
    background:black;
}
canvas{
    display:block;
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<!-- 背景音乐 -->
<audio id="bgm" loop>
  <source src="daylight.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let time = 0;

// 爱心位置
let heartPos = {x: canvas.width/2, y: canvas.height/2};
let targetPos = {x: heartPos.x, y: heartPos.y};

// 爱心状态
let heartScale = 15;
let heartAlpha = 1;
let heartDisappear = false;

// 星空粒子
const stars = [];
for(let i=0;i<200;i++){
    stars.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*1.5+0.5, alpha: Math.random()});
}

// 花瓣
const petals = [];
const petalColors = ['#ffb6c1','#ff69b4','#ffc0cb','#ff1493'];
for(let i=0;i<50;i++){
    petals.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, size: Math.random()*8+4, speed: Math.random()*1+0.5, color: petalColors[Math.floor(Math.random()*petalColors.length)], angle: Math.random()*Math.PI*2});
}

// 点击炸开的花瓣
const burstPetals = [];

// 爱心函数
function heartShape(t, scale){
    const x = 16 * Math.pow(Math.sin(t),3);
    const y = 13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t);
    return {x: x*scale, y: -y*scale};
}

// 绘制
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // 星空背景
    stars.forEach(s=>{
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, 2*Math.PI);
        ctx.fillStyle = `rgba(255,255,255,${s.alpha})`;
        ctx.fill();
        s.alpha += (Math.random()-0.5)*0.02;
        if(s.alpha>1) s.alpha=1;
        if(s.alpha<0) s.alpha=0;
    });

    // 普通花瓣
    petals.forEach(p=>{
        p.y += p.speed;
        p.x += Math.sin(time+p.angle)*0.5;
        if(p.y>canvas.height) p.y = -p.size;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
        ctx.fillStyle = p.color;
        ctx.fill();
    });

    // 炸开花瓣
    for(let i=burstPetals.length-1;i>=0;i--){
        let p = burstPetals[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.05; // 重力
        p.angle += 0.1;
        p.alpha -= 0.01; // 渐隐
        if(p.alpha <= 0){
            burstPetals.splice(i,1);
            continue;
        }
        ctx.save();
        ctx.translate(p.x,p.y);
        ctx.rotate(p.angle);
        ctx.globalAlpha = p.alpha;
        ctx.beginPath();
        ctx.arc(0,0,p.size,0,Math.PI*2);
        ctx.fillStyle = p.color;
        ctx.fill();
        ctx.restore();
        ctx.globalAlpha = 1;
    }

    // 爱心渐变发光
    if(!heartDisappear){
        let gradient = ctx.createRadialGradient(heartPos.x, heartPos.y, 10, heartPos.x, heartPos.y, 200);
        gradient.addColorStop(0,'#ff5c5c');
        gradient.addColorStop(0.5,'#ff2a8f');
        gradient.addColorStop(1,'#ff0000');

        ctx.fillStyle = gradient;
        ctx.shadowColor = '#ff69b4';
        ctx.shadowBlur = 20;

        ctx.globalAlpha = heartAlpha;
        ctx.beginPath();
        for(let t=0;t<Math.PI*2;t+=0.01){
            const p = heartShape(t, heartScale);
            if(t===0) ctx.moveTo(heartPos.x + p.x, heartPos.y + p.y);
            else ctx.lineTo(heartPos.x + p.x, heartPos.y + p.y);
        }
        ctx.closePath();
        ctx.fill();
        ctx.globalAlpha = 1;

        // 文字
        ctx.shadowBlur = 0;
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 48px sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.globalAlpha = heartAlpha;
        ctx.fillText('我爱你', heartPos.x, heartPos.y);
        ctx.globalAlpha = 1;
    }
}

// 动画
function animate(){
    time += 0.05;
    const scale = heartScale + 2*Math.sin(time*2); // 跳动

    // 爱心移动到目标位置
    heartPos.x += (targetPos.x - heartPos.x)*0.05;
    heartPos.y += (targetPos.y - heartPos.y)*0.05;

    // 爱心消失动画
    if(heartDisappear){
        heartScale *= 0.95;
        heartAlpha *= 0.95;
        if(heartAlpha < 0.05){
            heartAlpha = 0;
            heartDisappear = false; // 可重新点击
        }
    }

    draw();
    requestAnimationFrame(animate);
}

animate();

// 点击屏幕移动爱心并炸开花瓣
canvas.addEventListener('click', function(e){
    targetPos.x = e.clientX;
    targetPos.y = e.clientY;

    // 播放背景音乐淡入
    const bgm = document.getElementById('bgm');
    if(bgm.paused){
        bgm.volume = 0;
        bgm.play();
        let fadeIn = setInterval(()=>{
            if(bgm.volume < 0.7){
                bgm.volume += 0.01;
            } else clearInterval(fadeIn);
        },50);
    }

    setTimeout(()=>{
        // 爱心炸开
        heartDisappear = true;
        for(let i=0;i<30;i++){
            burstPetals.push({
                x: targetPos.x,
                y: targetPos.y,
                size: Math.random()*6+4,
                color: petalColors[Math.floor(Math.random()*petalColors.length)],
                angle: Math.random()*Math.PI*2,
                vx: (Math.random()-0.5)*6,
                vy: (Math.random()-0.5)*-6,
                alpha:1
            });
        }
    }, 500); // 移动后炸开
});
</script>
</body>
</html>
